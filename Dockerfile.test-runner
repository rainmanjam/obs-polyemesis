# Docker container for running C++ unit tests in isolated environment
# This solves port conflicts by providing isolated network namespaces per container
FROM ubuntu:24.04

# Prevent interactive prompts during package installation
ENV DEBIAN_FRONTEND=noninteractive

# Install all build and test dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    cmake \
    ninja-build \
    git \
    libcurl4-openssl-dev \
    libjansson-dev \
    libobs-dev \
    pkg-config \
    lsof \
    procps \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /workspace

# The source code will be mounted as a volume at runtime
# This allows for faster iteration without rebuilding the image

# Default command runs the test build and execution script
CMD ["bash", "-c", "echo 'Run tests with: ./scripts/run-unit-tests-docker.sh'"]
